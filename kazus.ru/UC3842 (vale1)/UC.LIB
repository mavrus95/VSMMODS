
.SUBCKT 1845AMP  4     1    9   20
*                VREF  INV  OUT V-
.MODEL QPMOD PNP
.MODEL DCLAMP D (RS=10 BV=5 IBV=.01)
.MODEL DMOD D
R1 10 4 100K
R2 10 20 100K
R3 6 20 316MEG
C1 6 20 15.9P
E1 5 20 6 20 1
R4 1 20 8MEG
I2 4 9 .8M
D12 9 4 DMOD
R6 20 3 300
D11 9 12 DMOD
Q1 20 13 12 QPMOD
I3 13 20 68U
D14 3 13 DMOD
D15 20 6 DCLAMP
L1 2 3 10U
C2 3 20 200P
R9 5 2 5
C5 2 20 .02U
G1 20 6 10 1 100U
.ENDS
*********
.SUBCKT 1845OUT  4  7  3  12
*                +V -V IN OUT
.MODEL QMOD NPN RC=1.5 RE=.5 RB=100 IKF=0.5 CJC=0.4P
.MODEL QMOD2 NPN TF=400P TR=400P
.MODEL QIN NPN BF=100 BR=2 IS=1E-16 VAF=50 
+ CJE=1.5P CJC=.15P TR=1N TF=4N
.MODEL DMOD D RS=1 IS=0.4U
I3 4 8 100U
D3 8 4 DMOD
D4 12 8 DMOD
Q3 8 1 9 QIN
Q4 12 9 7 QMOD
Q5 4 8 6 QMOD
I4 7 1 .9M
R1 3 2 10K
Q8 1 2 7 QIN
Q2 4 6 12 QMOD2
.ENDS

.SUBCKT OP3842 In out gnd
Vmin out 2 DC=0.6
R15 3 gnd 310Meg
Cp 3 gnd 16p
Dclamp gnd 3 DCLP3
D5 4 5 DCLP1
G1 gnd 3 11 In 100U
Isink 5 gnd DC=120u
Isource 6 out DC=900u
E1 7 gnd 3 gnd 1
Vclamp 6 gnd DC=5.3
Q1 gnd 5 2 QP
R2 7 8 1k
C2 8 gnd 35p
E2 gnd 4 8 gnd -1
D3 out 6 DCLP2
Vref 11 gnd DC=2.5V
*
.MODEL DCLP3 D BV=5 N=10m
.MODEL DCLP2 D BV=100V CJO=4PF IS=7E-09 M=.45 N=2 RS=.8
+ TT=6E-09 VJ=.6V
.MODEL QP PNP (BF=190 BR=2 CJC=7P CJE=6P IKF=30M IKR=10K IS=20F  
+ ISC=500P ISE=25F ITF=10M MJC=350M MJE=300M NE=1.3 RC=1 RE=700M TF=1N TR=200N  
+ VAF=90 VJC=690M VJE=690M VTF=10 XTF=500M)
.MODEL DCLP1 D BV=5
.ENDS OP3842

.SUBCKT DRIVER1  4  7  3  12
*               +V -V IN OUT
.MODEL QMOD NPN RC=0.5  RE=.5 RB=100  IKF=0.5
.MODEL QMOD2 NPN
.MODEL QIN NPN BF=100 BR=2 IS=1E-16 VAF=50 
+ CJE=0.5P CJC=.15P TR=1N TF=4N
.MODEL DMOD D RS=1 IS=0.4U
I3 4 8 100U
D3 8 4 DMOD
D4 12 8 DMOD
Q3 8 1 9 QIN
Q4 12 9 7 QMOD
Q5 4 8 6 QMOD
I4 7 1 .9M
R1 3 2 10K
Q8 1 2 7 QIN
Q2 4 6 12 QMOD2
.ENDS

.SUBCKT ERRAMP 20 8  3  21 
*   	       +  - OUT GND
RIN 20 8 8MEG
CP1 11 21 {1/(6.28*(31622/100u)*30)}
E1 5 21 11 21 1
R9 5 2 5
D14 2 13 DMOD
IS 13 21 0.15m	
Q1 21 13 16 QPMOD
ISRC 7 3 500U		
D12 3 7 DMOD
D15 21 11 DCLAMP
G1 21 11 20 8 100u
V1 7 21 3.6
V4 3 16 0.1
RP1 11 21 50000
.MODEL QPMOD PNP
.MODEL DCLAMP D (RS=10 BV=10 IBV=10m)
.MODEL DMOD D (TT=1N CJO=10P)
.ENDS ERRAMP 

.SUBCKT ERRAMP1 V+ V- OUT IN+ IN-
IBIAS V+ 1 10U  
M1 2 IN+ 1 V+ MOSP
M2 3 IN- 1 V+ MOSP
RD1 2 V- 10K    
RD2 3 V- 10K
C1 2 3 20P
*GAIN STAGE
G1 4 V- 3 2 0.1M
R1 4 V- 10K
G2 5 V- 4 V- 1
R2 5 V- 1K
EF1 OUT V- 5 V- 1
EVS 6 V- V+ V- 0.5
D1 5 7 DA
RLIM 7 6 10M
D2 V- 5 DA
*80K BW
CC1 OUT 4 194P
.MODEL MOSP PMOS(VTO=-0.7 KP=100E-5)
.MODEL DA D(IS=100E-14 N=100M)
.ENDS ERRAMP1
**************************************************

**************************************************
.SUBCKT ERRAMP2 V+ V- OUT IN+ IN-
IBIAS V+ 1 10U  
M1 2 IN+ 1 V+ MOSP
M2 3 IN- 1 V+ MOSP
RD1 2 V- 10K    
RD2 3 V- 10K
C1 2 3 1P
*GAIN STAGE
G1 4 V- 3 2 0.1M
R1 4 V- 10K
G2 5 V- 4 V- 1
R2 5 V- 1K
EF1 OUT V- 5 V- 1
EVS VA+ V- V+ V- 0.5
D1 5 6 DA
RLIM 6 VA+ 10M
D2 V- 5 DA
*4MEG BW
CC1 OUT 4 3.978P
.MODEL MOSP PMOS(VTO=-0.7 KP=100E-5)
.MODEL DA D(IS=100E-14 N=1M)
.ENDS ERRAMP2
